---
layout:       post                                          # 使用的布局（不需要改）
title:        一个简单的颜色动画工具类                      # 标题 
subtitle:     一个简单的颜色动画工具类                      # 副标题
date:         2018-03-07                                    # 时间
author:       xingxingxiaoyu                                # 作者
header-img:   "img/IMG_012.jpg"                             # 这篇文章标题背景图片
catalog:      true                                          # 是否归档
tags:                                                       # 标签
    - Android
---

######简述
- 在做Android开发的时候，有很多地方要使用到颜色渐变的动画，所有我封装了一个简单的处理颜色渐变动画的工具类，先看使用效果展示：
![效果演示](http://upload-images.jianshu.io/upload_images/2292129-769509c537a08ff8.gif?imageMogr2/auto-orient/strip)
######使用方式
- 先使用newInstance()方法获取类的对象
<pre>ColorAnimatorUtils colorAnimatorUtils = clorAnimatorUtils.newInstance();</pre>
- 然后调用方法startAnimator，他接受四个参数：
<pre>
/*** @param startColor 起始颜色
     * @param endColor   终止颜色
     * @param view       控件
     * @param attr       属性
     */
public void startAnimator(final int startColor, final int endColor,
 final View view, final String attr)</pre>
- 调用试例：
<pre>
colorAnimatorUtils.startAnimator(Color.WHITE, 
Color.RED, view, "BackgroundColor");</pre>
- 如此就能实现view的背景色从白色渐变为红色。
还可以通过colorAnimatorUtils.setDuration()方法设置动画的时间。

如果想把渐变的颜色设置在非属性上可以调用重载方法：
<pre>/**
     * @param startColor 起始颜色
     * @param endColor   终止颜色
     * @param view       控件
     * @param listener   颜色渐变监听
     */
    public void startAnimator(final int startColor, final int endColor, 
final View view, @NonNull final OnColorChangeListener listener)</pre>
- 使用试例：
<pre>colorAnimatorUtils.startAnimator(Color.WHITE, Color.RED, imageView, new ColorAnimatorUtils.OnColorChangeListener()
    {
         @Override
         public void colorChange(int color)
         {
             imageView.setImageDrawable(new ColorDrawable(color));
         }
     });</pre>

######实现思路
实现的思路很简单流程如下:
> 1.获取传入颜色的ARGB值
> 2.使用属性动画生成动画，并在属性值改变的监听里通过反射设置属性值如果是重载的方法则调用颜色改变的接口回调方法
> 3.开启动画

- 通过动画进度获取颜色的方法：
<pre>public int getProgressColor(int startColor, int endColor, float progress)
    {
        int alpha = getValue((startColor & 0xFF000000) >> 24, (endColor & 0xFF000000) >> 24, progress);
        int red = getValue((startColor & 0x00FF0000) >> 16, (endColor & 0x00FF0000) >> 16, progress);
        int green = getValue((startColor & 0x0000FF00) >> 8, (endColor & 0x0000FF00) >> 8, progress);
        int blue = getValue(startColor & 0x000000FF, endColor & 0x000000FF, progress);
        return alpha << 24 | red << 16 | green << 8 | blue;

    }

    private int getValue(int start, int end, float progress)
    {
        return start + (int) ((end - start) * progress);
    }</pre>

不要使用
<pre>int blue = getValue(startColor % 0x100, endColor % 0x100, progress);</pre>这种方式来获取颜色的各分量值，会有问题，我会在下一篇文章中详细分析该问题。
- 获取反射的方法
<pre>private Method getMethod(View view, String attr)
    {
        final Class aClass = view.getClass();
        Method method = null;
        try
        {
            method = aClass.getMethod("set" + attr, Integer.TYPE);
        } catch (NoSuchMethodException e)
        {
            e.printStackTrace();
        }
        return method;
    }</pre>

- startAnimator方法：
<pre>public void startAnimator(final int startColor, final int endColor, final View view, final String attr)
    {
        ValueAnimator valueAnimator = ValueAnimator.ofFloat(0, 1);
        valueAnimator.setDuration(duration);
        valueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener()
        {
            @Override
            public void onAnimationUpdate(ValueAnimator animation)
            {
                float value = (float) animation.getAnimatedValue();
                int progressColor = getProgressColor(startColor, endColor, value);

                try
                {
                    final Method method = getMethod(view, attr);
                    if (method == null)
                    {
                        return;
                    }
                    method.invoke(view, progressColor);
                } catch (Exception e)
                {
                    e.printStackTrace();
                }
            }
        });
        valueAnimator.start();
    }</pre>

完整的代码可以在我的Github里面查看：
https://github.com/xingxingxiaoyu/ColorAnimator
